<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Soure</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="index-layout">
    <aside class="index-sidebar">
      <div class="brand">
        <h1>Soure</h1>
        <p>Strategy Â· Resources Â· Barbarians</p>
      </div>
      <nav class="index-menu">
        <a class="sidebar-tab active" href="/game">
          <span class="tab-icon">ğŸ®</span>
          <span>Game</span>
        </a>
        <a class="sidebar-tab" href="#" onclick="alert('Coming soon'); return false;">
          <span class="tab-icon">ğŸ‘¥</span>
          <span>Friends</span>
        </a>
        <a class="sidebar-tab" href="#" onclick="alert('Coming soon'); return false;">
          <span class="tab-icon">ğŸ“¦</span>
          <span>Resources</span>
        </a>
        <a class="sidebar-tab" href="#" onclick="alert('Coming soon'); return false;">
          <span class="tab-icon">âš™ï¸</span>
          <span>Settings</span>
        </a>
      </nav>
      <div id="authButtons" class="auth-section" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
        <a class="btn" href="/register" id="registerBtn" style="width: 100%; margin-bottom: 8px;">Register</a>
        <a class="btn btn-primary" href="/login" id="loginBtn" style="width: 100%;">Login</a>
      </div>
      <div id="loggedInSection" class="auth-section hidden" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
        <div id="userInfo" style="margin-bottom: 12px; font-size: 0.85rem; color: var(--muted);"></div>
        <a class="btn btn-primary" href="/game" id="enterGameBtn" style="width: 100%;">Enter Game</a>
      </div>
      <div class="index-hint">
        Create or join a game on the Game page. 1â€“4 players, resources, doubles, barbarians on 8.
      </div>
    </aside>
    <main class="index-main">
      <div class="index-center">
        <h1 class="index-title">Soure</h1>
        <p class="index-subtitle">
          Roll dice. Lose friends. Gain empire.
        </p>
        <div class="index-chips">
          <button type="button" class="chip" id="chipResources">Clay Â· Flint Â· Sand Â· Water Â· Cattle Â· People</button>
          <button type="button" class="chip" id="chipDoubles">Doubles = Extra Turn</button>
          <button type="button" class="chip" id="chipBarbarians">Barbarians on 8</button>
        </div>
      </div>
    </main>
  </div>
  <script>
    (function () {
      "use strict";
      
      const $ = (id) => document.getElementById(id);
      
      function showLoggedOut() {
        const authButtons = $("authButtons");
        const loggedInSection = $("loggedInSection");
        if (authButtons) authButtons.classList.remove("hidden");
        if (loggedInSection) loggedInSection.classList.add("hidden");
      }
      
      function showLoggedIn(user) {
        const authButtons = $("authButtons");
        const loggedInSection = $("loggedInSection");
        const userInfo = $("userInfo");
        
        if (authButtons) authButtons.classList.add("hidden");
        if (loggedInSection) loggedInSection.classList.remove("hidden");
        if (userInfo && user) {
          userInfo.textContent = "Logged in as: " + user.username;
        }
      }
      
      function checkAuth() {
        fetch("/api/me", { credentials: "same-origin" })
          .then((r) => r.json())
          .then((data) => {
            if (data.ok && data.user) {
              showLoggedIn(data.user);
            } else {
              showLoggedOut();
            }
          })
          .catch((err) => {
            console.error("[index] Auth check failed:", err);
            showLoggedOut();
          });
      }
      
      // Check auth on page load
      checkAuth();
    })();
  </script>
</body>
</html>
